<ng-container *transloco="let t; read: 'translate.language-selector'">
  <ion-segment (ionChange)="onSegmentChange($event)" [value]="selectedIndex.toString()" class="language-segment">
    @if (hasLanguageDetection) {
      @if (detectedLanguage && !language) {
        <ion-segment-button [value]="'0'">
          <ion-label>{{ t('detected', {lang: langNames[detectedLanguage]}) }}</ion-label>
        </ion-segment-button>
      } @else {
        <ion-segment-button [value]="'0'">
          <ion-label>{{ t('detect') }}</ion-label>
        </ion-segment-button>
      }
    }
    @for (lang of topLanguages; track lang; let i = $index) {
      <ion-segment-button [value]="(i + (hasLanguageDetection ? 1 : 0)).toString()">
        <ion-label>
          @if (flags) {
            <app-flag-icon [country]="langCountries[lang]" [squared]="true" />
          }
          {{ langNames[lang] }}
        </ion-label>
      </ion-segment-button>
    }
  </ion-segment>

  <!-- Language button for small screens -->
  @if (hasLanguageDetection && detectedLanguage && !language) {
    <ion-button
      [matMenuTriggerFor]="signedLanguagesMenu"
      class="menu-language-button"
      color="primary"
      expand="full"
      fill="clear">
      @if (flags) {
        <app-flag-icon [country]="langCountries[detectedLanguage]" [squared]="true" />
      }
      <span class="wrap-text">{{ t('detected', {lang: langNames[detectedLanguage]}) }}</span>
    </ion-button>
  } @else {
    <ion-button
      [matMenuTriggerFor]="signedLanguagesMenu"
      class="menu-language-button"
      color="primary"
      expand="full"
      fill="clear">
      @if (language) {
        @if (flags) {
          <app-flag-icon [country]="langCountries[language]" [squared]="true"></app-flag-icon>
        }
        <span class="wrap-text">{{ langNames[language] }}</span>
      } @else {
        {{ t('detect') }}
      }
    </ion-button>
  }

  <!-- Expand icon for large screens -->
  <ion-button
    fill="clear"
    color="medium"
    [matMenuTriggerFor]="signedLanguagesMenu"
    class="menu-icon-button"
    [attr.aria-label]="t('more')">
    <ion-icon name="chevron-down" slot="icon-only" />
  </ion-button>
  <mat-menu #signedLanguagesMenu class="language-selector-menu">
    <ng-template matMenuContent>
      @if (hasLanguageDetection) {
        <button (click)="selectLanguage(null)" mat-menu-item>
          {{ t('detect') }}
        </button>
      }
      @for (language of languages; track language) {
        <button (click)="selectLanguage(language)" mat-menu-item>
          @if (flags) {
            <app-flag-icon [country]="langCountries[language]" [squared]="true"></app-flag-icon>
          }
          {{ langNames[language] }}
        </button>
      }
    </ng-template>
  </mat-menu>
</ng-container>
